{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
	  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
	  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
	    
	  <link href="{% static 'stagb/css/semantic.min.css' %}" rel="stylesheet" />
	  <link href="{% static 'stagb/plugins/ionicons/css/ionicons.min.css' %}" rel="stylesheet" />
	    
	  <link href="{% static 'stagb/css/main.css' %}" rel="stylesheet" />
	  <link href="{% static 'stagb/plugins/pacejs/pace.css' %}" rel="stylesheet" />
    <title>小站号配置</title>
	</head>

  <body>
    <div class="ui segment">
      <div class="ui equal width grid"> 
        <div class="row" style="margin:0px;padding:5px;">
          <div class="three wide column">
            <button class="ui labeled icon button greenli" id="manage_add">
              <i class="right add square icon"></i>新增
            </button>
            <button class="ui labeled icon button yellow" id="manage_operate" data-column="6" >
              <i class="right configure icon"></i>操作
            </button>
          </div>
          <div class=" right aligned column">
            <div class="ui buttons blue">
              <div class="ui button">导出脚本</div>
              <div class="ui floating dropdown icon button">
                <i class="dropdown icon"></i>
                <div class="menu" data-filtered="filtered">
                  <a class="item" href="{% url 'stationconfig:export_getfile' %}" target="_blank"><i class="edit icon" data-filtered="filtered"></i> 导出GetFile脚本</a>
                  <a class="item" href="{% url 'stationconfig:export_putfile' %}" target="_blank"><i class="delete icon" data-filtered="filtered"></i> 导出PutFile脚本</a>
                  <a class="item" href="{% url 'stationconfig:export_movefile' %}" target="_blank"><i class="hide icon" data-filtered="filtered"></i> 导出文件移动脚本</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <form class="ui form" id="search_modal_form" action="{% url 'stationconfig:search' %}" method='post' enctype="multipart/form-data">
    	  {% csrf_token %} 
	      <div class="inline fields">
          <div class="field">
            <label for="search_manager" class="control-label">管理人：</label>
            <div class="ui search small selection dropdown" id="search_manager">
              <input type="hidden" name="search_manager" >
              <div class="default text">管理人</div>
              <i class="dropdown icon"></i>
            </div> 
          </div>
          <div class="field">
            <label for="search_fund" class="control-label">项目名称：</label>
            <div class="ui search small selection dropdown" id="search_fund">
              <input type="hidden" name="search_fund" >
              <div class="default text">项目名称</div>
              <i class="dropdown icon"></i>
            </div>
          </div>  
          <div class="field" id="advanced_field1">
            <label>数据类型： </label>
            <select class="ui search small dropdown" name="search_fundtype">
              <option value="" data-filtered="filtered">数据类型</option>
              <option value="xbrl" data-filtered="filtered">xbrl</option>
              <option value="ta" data-filtered="filtered">ta</option>
            </select>
          </div>
          <div class="field" id="advanced_field2">
            <label>历史数据：</label>
            <select class="ui search small dropdown" name="search_history">
              <option value="" data-filtered="filtered">是否历史数据</option>
              <option value=True data-filtered="filtered">是</option>
              <option value=False data-filtered="filtered">否</option>
            </select>
          </div>
              
          <div class="field">
            <button class="ui labeled icon blue basic right floated button" type="submit" id="fund_search" >
            <i class="right search icon"></i>搜索
            </button>
          </div> 
          <div class="field">
            <button class="ui labeled icon purple basic left floated button" type="button" id="advanced_find">
            <i class="right zoom icon"></i>高级
            </button>
          </div>
        </div>
      </form>
              
      <table id="data_table" class="ui compact selectable striped celled table tablet stackable display" cellspacing="0" width="100%" >
        <thead>
          <tr class="center aligned">
            <th>管理人</th>
            <th>管理人代码</th>
            <th>项目名称</th>
            <th>项目代码</th>
            <th>数据类型</th>
            <th>是否历史数据</th>
            <th>操作</th>
                            
            <th style="display:none">pathfrom</th>
            <th style="display:none">pathto_temp</th>
            <th style="display:none">move</th>
            <th style="display:none">pathto</th>
            <th style="display:none">md</th>
            <th style="display:none">mput</th>
            <th style="display:none">send</th>
            <th style="display:none">if_exist</th>
            <th style="display:none">move_file</th>
          </tr>
        </thead>
        <tbody>
	        {% for fund in funds %} 
	        <tr>
	          <td class="manager" id="{{ fund.manager.id }}">{{ fund.manager.name }}</td>
	          <td class="manager_code">{{ fund.manager.code }}</td>
	          <td class="fundname" id="{{ fund.id }}">{{ fund.fundname }}</td>
	          <td class="fundcode">{{ fund.code }}</td>
	          <td class="fundtype">{{　fund.type }}</td>
	          <td class="history">{{ fund.is_history }}</td>
	          <td>
              <button class="ui labeled icon button modify teal">
              <i class="right write icon"></i>修改
              </button>                      
              <button class="ui labeled icon button delete redli">
              <i class="right remove icon"></i>删除
              </button>
	          </td>
	          <td class="pathfrom" style="display:none">{{ fund.pathfrom }}</td>
            <td class="pathto_temp" style="display:none">{{ fund.pathto_temp }}</td>
            <td class="move" style="display:none">{{ fund.move }}</td>
            <td class="pathto" style="display:none">{{ fund.pathto }}</td>
            <td class="md" style="display:none">{{ fund.md }}</td>
            <td class="mput" style="display:none">{{ fund.mput }}</td>
            <td class="send" style="display:none">{{ fund.send }}</td>
            <td class="if_exist" style="display:none">{{ fund.if_exist }}</td>
            <td class="move_file" style="display:none">{{ fund.move_file }}</td>
	        </tr>
			    {% endfor %}
        </tbody>
      </table>
    </div>    

    <!-- 新增modal -->
    <div class="ui modal" id="add_modal">
      <div class="header">添加新基金</div>
      <div class="content">
        <form class="ui form" id="add_modal_form" action="{% url 'stationconfig:add' %}" method='post' enctype="multipart/form-data" onsubmit="alert('添加成功')">
    	  {% csrf_token %}
          <h4>项目信息:</h4>
          <div class="three fields">
            <div class="field">
              <label>管理人</label>
              <input placeholder="管理人" name="add_manager" type="text" required="required" id="add_manager">
            </div>
            <div class="field">
              <label>管理人代码</label>
              <input placeholder="管理人代码" name="add_manager_code" type="text" required="required" id="add_manager_code">
            </div>
            <div class="field">
              <label>项目名称</label>
              <input placeholder="项目名称" name="add_fundname" type="text" required="required" id="add_fundname">
            </div>
          </div>
          <div class="three fields">
            <div class="field">
              <label>项目代码</label>
              <input placeholder="项目代码" name="add_fundcode" type="text" id="add_fundcode">
            </div>
            <div class="field">
              <label>项目类型</label>
              <select class="ui selection " name='add_fundtype' id="add_fundtype" >
                <option value='xbrl' >xbrl</option>
                <option value='ta'>ta</option>  
              </select>
            </div>
            <div class="field">
              <label>是否历史数据</label>
              <select class="ui selection" name='add_history' id="add_history" >
                <option value='True' data-filtered="filtered">True</option>
                <option value='False' data-filtered="filtered">False</option>  
              </select>
            </div>
          </div>

          <h4>GetFile:</h4>
          <div class="four fields">
            <div class="field">
              <label>java -Dfile.encoding=GBK  -cp E:\\lgfilecomm-1.4.2.6.jar com.filecomm.fileClient mget 10.99.165.82 8686 10.99.165.82 %pathfrom%</label>
              <input placeholder="pathfrom" name="add_pathfrom" type="text" required="required" id="add_pathfrom">
            </div>
            <div class="field">
              <label><br><br><br><br>%pathto%</label>
              <input placeholder="pathto_temp" name="add_pathto_temp" type="text" required="required" id="add_pathto_temp">
            </div>
            <div class="field">
              <label><br><br><br><br>move %pathto%</label>
              <input placeholder="move" name="add_move" type="text" required="required" id="add_move">
            </div>
            <div class="field">
              <label><br><br><br><br>%pathto%</label>
              <input placeholder="pathto" name="add_pathto" type="text" required="required" id="add_pathto">
            </div>
          </div>

          <h4>PutFile:</h4>
          <div class="three fields">
            <div class="field">
              <label><br><br>md E:\XBRL\sign\</label>
              <input placeholder="md" name="add_md" type="text" required="required" id="add_md">
              <label>send</label>
            </div>
            <div class="field">
              <label>java -Dfile.encoding=GBK  -cp E:\\lgfilecomm-1.4.2.6.jar com.filecomm.fileClient mput 10.99.165.82 8686 10.99.165.82 E:/XBRL/sign/</label>
              <input placeholder="mput" name="add_mput" type="text" required="required" id="add_mput">
              <label>send</label>
            </div>
            <div class="field">
              <label><br><br>E:/send/</label>
              <input placeholder="send" name="add_send" type="text" required="required" id="add_send">
            </div>
          </div>

          <h4>文件移动:</h4>
          <div class="two fields">
            <div class="field">
              <label>IF EXIST E:\XBRL\sign\</label>
              <input placeholder="if_exist" name="add_if_exist" type="text" required="required" id="add_if_exist">
              <label>move</label>
            </div>
            <div class="field">
              <label>E:\XBRL\sign\</label>
              <input placeholder="move_file" name="add_move_file" type="text" required="required" id="add_move_file">
            </div>
          </div>

          <div class="ui error message"></div>
          <div class="ui hidden divider"></div>
          <div class="actions" style="position:relative;left:75%;">
            <button class="ui labeled icon button redli" type="button" id="add_close" data-dismiss="add_modal">
            <i class="right close icon"></i>取消
            </button>
            <button class="ui labeled icon ok button blueli" type="submit" id="add_submit">
            <i class="right checkmark icon"></i>提交            
            </button>
          </div>
		    </form>
      </div>
    </div>

    <!-- 修改modal -->
    <div class="ui modal" id="modify_modal" >
      <div class="header">修改基金</div>
      <div class="content">
        <form class="ui form" id="modify_modal_form" action="{% url 'stationconfig:modify' %}" method='post' enctype="multipart/form-data" onsubmit="alert('修改成功')">
          {% csrf_token %}
          <h4>项目信息:</h4>
          <div class="three fields">
            <div class="field">
              <label for="modify_manager" class="control-label">管理人</label>
              <div class="ui search selection dropdown" id="modify_manager">
                <input type="hidden" name="modify_manager" >
                <div class="default text">管理人</div>
                <i class="dropdown icon"></i>
              </div> 
            </div>
            <div class="field">
              <label>管理人代码</label>
              <input placeholder="管理人代码" name="modify_manager_code" type="text" required="required" id="modify_manager_code">
            </div>
            <div class="field">
              <label for="modify_fund" class="control-label">项目名称</label>
                <input placeholder="项目名称" name="modify_fund" type="text" required="required" id="modify_fund">
            </div>
          </div>

          <div class="three fields">
            <div class="field">
              <label>项目代码</label>
              <input placeholder="项目代码" name="modify_fundcode" type="text"  id="modify_fundcode">
            </div>
            <div class="field">
              <label for="modify_fundtype" class="control-label">项目类型</label>
              <div class="ui search selection dropdown" id="modify_fundtype">
                <input type="hidden" name="modify_fundtype" >
                <div class="default text">项目类型</div>
                <i class="dropdown icon"></i>
                <div class="menu" data-filtered="filtered">
                  <div class="item" data-value="xbrl" data-filtered="filtered" id='11'>xbrl</div>
                  <div class="item" data-value="ta" data-filtered="filtered">ta</div>
                </div>  
              </div> 
            </div>
            <div class="field">
              <label for="modify_history" class="control-label">是否历史数据</label>
              <div class="ui search selection dropdown" id="modify_history">
                <input type="hidden" name="modify_history" >
                <div class="default text">是否历史数据</div>
                <i class="dropdown icon"></i>
                <div class="menu" data-filtered="filtered">
                  <div class="item" data-value="True" data-filtered="filtered">True</div>
                  <div class="item" data-value="False" data-filtered="filtered">False</div>
                </div>  
              </div> 
            </div>
            <div class="field" style="display:none">
              <label>id</label>
              <input class="ui selection" name='modify_fundid' id="modify_fundid" >
            </div>
          </div>
          
          <div id='xbrl_data'>
          <h4>GetFile:</h4>
          <div class="four fields">
            <div class="field">
              <label>java -Dfile.encoding=GBK  -cp E:\\lgfilecomm-1.4.2.6.jar com.filecomm.fileClient mget 10.99.165.82 8686 10.99.165.82 %pathfrom%</label>
              <input placeholder="pathfrom" name="modify_pathfrom" type="text" required="required" id="modify_pathfrom">
            </div>
            <div class="field">
              <label><br><br><br><br>%pathto%</label>
              <input placeholder="pathto_temp" name="modify_pathto_temp" type="text" required="required" id="modify_pathto_temp">
            </div>
            <div class="field">
              <label><br><br><br><br>move %pathto%</label>
              <input placeholder="move" name="modify_move" type="text" required="required" id="modify_move">
            </div>
            <div class="field">
              <label><br><br><br><br>%pathto%</label>
              <input placeholder="pathto" name="modify_pathto" type="text" required="required" id="modify_pathto">
            </div>
          </div>

          <h4>PutFile:</h4>
          <div class="three fields">
            <div class="field">
              <label><br><br>md E:\XBRL\sign\</label>
              <input placeholder="md" name="modify_md" type="text" required="required" id="modify_md">
              <label>send</label>
            </div>
            <div class="field">
              <label>java -Dfile.encoding=GBK  -cp E:\\lgfilecomm-1.4.2.6.jar com.filecomm.fileClient mput 10.99.165.82 8686 10.99.165.82 E:/XBRL/sign/</label>
                    <input placeholder="mput" name="modify_mput" type="text" required="required" id="modify_mput">
                    <label>send</label>
            </div>
            <div class="field">
              <label><br><br>E:/send/</label>
              <input placeholder="send" name="modify_send" type="text" required="required" id="modify_send">
            </div>
          </div>

          <h4>文件移动:</h4>
          <div class="two fields">
            <div class="field">
              <label>IF EXIST E:\XBRL\sign\</label>
              <input placeholder="if_exist" name="modify_if_exist" type="text" required="required" id="modify_if_exist">
              <label>move</label>
            </div>
            <div class="field">
              <label>E:\XBRL\sign\</label>
              <input placeholder="move_file" name="modify_move_file" type="text" required="required" id="modify_move_file">
            </div>
          </div>
        </div>
          
          <div class="ui error message"></div>
          <div class="ui hidden divider"></div>
          <div class="actions" style="position:relative;left:75%;">
            <button class="ui labeled icon button redli" type="button" id="modify_close" data-dismiss="modify_modal">
            <i class="right close icon"></i>取消
            </button>
            <button class="ui labeled icon ok button blueli" type="submit" id="modify_submit">
            <i class="right checkmark icon"></i>提交            
            </button>
          </div>
		    </form>
      </div>
    </div>

    <!-- 删除modal -->
    <div class="ui modal" id="delete_modal">
      <div class="header">删除基金</div>
      <div class="content">
        <form class="ui form" id="delete_modal_form" action="{% url 'stationconfig:delete' %}" method='post' enctype="multipart/form-data" onsubmit="alert('删除成功')">
          {% csrf_token %}
          <input style="display:none" id="delete_fundid" name="delete_fundid">
          <h4>确定删除</h4>
          <h4><span style="color:red" id="delete_manager"></span> （ 
              <span style="color:red" id="delete_manager_code"></span> ） 的项目
              <span style="color:red" id="delete_fundname"></span> （ 
              <span style="color:red" id="delete_fundtype"></span>） 基金吗？
          </h4>
          <div class="ui hidden divider"></div>
          <div class="actions">
            <button class="ui labeled icon right floated ok button blueli" type="submit" id="delete_submit">
            <i class="right checkmark icon"></i>确定            
            </button>
            <button class="ui labeled icon right floated button redli" type="button" id="delete_close" data-dismiss="delete_modal">
            <i class="right close icon"></i>取消
            </button>
          </div>
		    </form>
      </div>
    </div>

    <script src="{% static 'stagb/js/jquery-2.1.4.min.js' %}"></script>
    <script src="{% static 'stagb/css/semantic.min.js' %}"></script>
    <script src="{% static 'stagb/plugins/cookie/js.cookie.js' %}"></script>
	  <script src=" {% static 'stagb/plugins/nicescrool/jquery.nicescroll.min.js' %}"></script>
	
	  <script data-pace-options='{ "ajax": false }' src="{% static 'stagb/plugins/pacejs/pace.js' %}"></script>
    <script src="{% static 'stagb/plugins/datatable/jquery.dataTables.js' %}"></script>
     
    <script src="{% static 'stagb/js/main.js' %}"></script>
    <script src="{% static 'js/stationconfig_table.js' %}"></script>
    
    <script>
    $("[id^='advanced_field']").hide();

    $('#advanced_find').on('click', function(){
      $("[id^='advanced_field']").toggle();
    });
     

     
    $("#search_manager").dropdown({
        apiSettings: {
              url: "{% url 'stationconfig:query_json_manager' %}" },
        saveRemoteData:false,
        onChange:function(value, text){
        	    $("#search_fund").dropdown({
        	        apiSettings: {
        	            url: '/stationconfig/fund/query/json/'+value },
        	        saveRemoteData:false,
              });
              $("#search_fund").dropdown('clear');
        },
    });
    
    
    $("#search_fund").dropdown({
        apiSettings: {
            url: '/stationconfig/fund/query/json/' },
          saveRemoteData:false,}
        );
     
     
    $(".ui.modal").modal({
    		detachable:			true,
      	autofocus:			false,
    		observeChanges:		false,		
    		allowMultiple:		false,
    		keyboardShortcuts:	false,
    		context:			"body",
    		closable:			false,
    		transition:			"scale",
    		duration:			400, 
    		inverted: 			true,
    	  blurring: 			false
    });
 
    $('#manage_add').on('click', function(){
	    $("#add_modal").modal("show");
    });

    $('#add_close').on('click', function(){
      $("#add_modal").modal("hide");
    });
    
    $("#xbrl_data").hide();


    $('.modify').on('click', function(){ 	    
 	    var manager_id = $(this).parents("tr").find(".manager").attr("id");
      var manager = $(this).parents("tr").find(".manager").text();
 	    var manager_code = $(this).parents("tr").find(".manager_code").text();
 	    var fundname = $(this).parents("tr").find(".fundname").text();
 	    var fundid = $(this).parents("tr").find(".fundname").attr("id");
 	    var fundcode = $(this).parents("tr").find(".fundcode").text();
 	    var fundtype = $(this).parents("tr").find(".fundtype").text();
      var history =$(this).parents("tr").find(".history").text();
        
    	var pathfrom = $(this).parents("tr").find(".pathfrom").text();
    	var pathto_temp = $(this).parents("tr").find(".pathto_temp").text();
    	var move = $(this).parents("tr").find(".move").text();
    	var pathto = $(this).parents("tr").find(".pathto").text();
    	var md = $(this).parents("tr").find(".md").text();
    	var mput = $(this).parents("tr").find(".mput").text();
    	var send = $(this).parents("tr").find(".send").text();
    	var if_exist = $(this).parents("tr").find(".if_exist").text();
    	var move_file = $(this).parents("tr").find(".move_file").text();
    	


      $("#modify_manager").dropdown('set text', manager);
      $("#modify_manager").dropdown('set value', manager_id); 
      $("#modify_manager").dropdown({
        apiSettings: {
              url: "{% url 'stationconfig:query_json_manager' %}" },
        saveRemoteData:false,
        onChange:function(value, text, $choice){ 
          id = $('#modify_manager').dropdown('get value');
          $.ajaxSetup({ data: {csrfmiddlewaretoken: '{{ csrf_token }}' },   });
          $.ajax({    
            type:'post',        
            url:"{% url 'stationconfig:select_manager' %}",    
            data:{'manager_id':id},   
            cache:false,    
            dataType:'json',    
            success:function(data,textStatus,jqXHR){
              $("#modify_manager_code").attr({"value" : data.manager_code});},
          });
        },
      });
 	    $("#modify_manager_code").attr({"value" : manager_code});
   	  $("#modify_fund").attr({"value" : fundname});
   	  $("#modify_fundid").attr({"value" : fundid});
   	  $("#modify_fundcode").attr({"value" : fundcode});
       
      $("#modify_fundtype").dropdown('set text', fundtype);
      $("#modify_fundtype").dropdown('set value', fundtype); 
      $("#modify_fundtype").dropdown({
        onChange:function(value){ 
          if (value=='xbrl'){$("#xbrl_data").show();}
          if (value=='ta'){$("#xbrl_data").hide();}
        },
      });


      $("#modify_history").dropdown('set text', history);
      $("#modify_history").dropdown('set value', history); 



   	  $("#modify_pathfrom").attr({"value" : pathfrom});
      $("#modify_pathto_temp").attr({"value" : pathto_temp});
      $("#modify_move").attr({"value" : move});
      $("#modify_pathto").attr({"value" : pathto});
      $("#modify_md").attr({"value" : md});
      $("#modify_mput").attr({"value" : mput});
      $("#modify_send").attr({"value" : send});
      $("#modify_if_exist").attr({"value" : if_exist});
      $("#modify_move_file").attr({"value" : move_file});
      

     
      if (fundtype=='xbrl'){
        $("#xbrl_data").show();}
      
       
      if (history=='True'){
      	$("#history_True").attr("selected","selected");
        $("modify_pathfrom").attr({"value" : pathfrom});
        $("#modify_pathto_temp").attr({"value" : pathto_temp});
        $("#modify_move").attr({"value" : move});
        $("#modify_pathto").attr({"value" : pathto});
        $("#modify_md").attr({"value" : md});
        $("#modify_mput").attr({"value" : mput});
        $("#modify_send").attr({"value" : send});
        $("#modify_if_exist").attr({"value" : if_exist});
        $("#modify_move_file").attr({"value" : move_file});
      }
        $("#modify_modal").modal("show"); 
      });
        
    
 



    $('#modify_close').on('click', function(){
      $("#modify_modal").modal("hide");
    });
     
    $('.delete').on('click', function(){
      var fundid = $(this).parents("tr").find(".fundname").attr("id");
  	  var manager = $(this).parents("tr").find(".manager").text(); 
      var manager_code = $(this).parents("tr").find(".manager_code").text(); 
  	  var fundname = $(this).parents("tr").find(".fundname").text();
      var fundtype = $(this).parents("tr").find(".fundtype").text();
 
      $("#delete_fundid").attr({"value" : fundid});
      document.getElementById("delete_manager").innerHTML = manager;
      document.getElementById("delete_manager_code").innerHTML = manager_code;
      document.getElementById("delete_fundname").innerHTML = fundname;
      document.getElementById("delete_fundtype").innerHTML = fundtype;
      $("#delete_modal").modal("show");
    });
     
    $('#delete_close').on('click', function(){
      $("#delete_modal").modal("hide");
    });

    </script>
  </body> 
</html>